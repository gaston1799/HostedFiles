<!DOCTYPE html>
<html>

<head>
  <script type="module">
  import {Octokit,App} from "https://cdn.skypack.dev/octokit";
import {Base64} from 'https://cdn.jsdelivr.net/npm/js-base64@3.7.2/base64.mjs';
import {createOrUpdateTextFile,composeCreateOrUpdateTextFile,} from "https://cdn.pika.dev/@octokit/plugin-create-or-update-text-file";
    window.Octokit=Octokit
    window.App=App
    window.Base64=Base64
    window.createOrUpdateTextFile=createOrUpdateTextFile
    window.composeCreateOrUpdateTextFile=composeCreateOrUpdateTextFile
  </script>
  <script>async function getBase64(){
    return await axios.get(url, { responseType: 'arraybuffer' })
        .then((response) => {
        let image = btoa(
            new Uint8Array(response.data)
            .reduce((data, byte) => data + String.fromCharCode(byte), '')
        );
        return `data:${response.headers['content-type'].toLowerCase()};base64,${image}`;
    });
}</script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script type="module">
    import { Octokit } from "https://cdn.skypack.dev/@octokit/rest";
  </script>
  <title>my site OK!</title>
  <meta http-equiv="Content-Security-Policy"
    content="default-src * gap:; script-src * 'unsafe-inline' 'unsafe-eval'; connect-src *; img-src * data: blob: android-webview-video-poster:; style-src * 'unsafe-inline';  frame-ancestors 'none'; base-uri 'self';">
  <script src="index.js"></script>
  <script src="yes.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src='CustomLogging.js'></script>
  <script>
    (async () => {
      const request = new XMLHttpRequest();
      const url = `https://raw.githubusercontent.com/liddiard/text-diff/master/diff.js`;
      request.open("GET", url);
      request.send();
      await new Promise((..._) => {
        request.onload = (e) => {
          try {
            eval(request.responseText)
          } catch (err) { }
          _[0]()
        }
      });
      console.log('Script difference loaded')
      return function (...a) { }
    })();

  </script>
  <link rel="stylesheet" href="main.css">
  <style>
    #video {
      border: 1px solid #999;
      width: 98%;
      max-width: 860px;
    }

    .error {
      color: red;
    }

    .warn {
      color: orange;
    }

    .info {
      color: darkgreen;
    }
  </style>
</head>

<body>
  <div id="particles-js"></div>
  <script src="particles.js"></script>
  <script src="particles.min.js"></script>
  <h2 class="bass-title">
    <span class="bass-blur logo-neon">
      <span class="text-Logo pulse1">
        V:36
      </span>
    </span>
  </h2>
  <hr>
  <br><br>
  <span id="_fps">
    <script>
      const times = [];
      var fps = 0;

      function refreshLoop() {
        window.requestAnimationFrame(() => {
          const now = performance.now();
          while (times.length > 0 && times[0] <= now - 1000) {
            times.shift()
          };
          times.push(now);
          fps = times.length, _fps.innerText = 'FPS:' + fps, refreshLoop()
        })
      }
      refreshLoop()

    </script>
  </span>
  <br><br>
  <div id="filediv" style="width: 30%;border: 2px dashed red;">
    <script>
      var Video = new VideoPlayer()

      function element(_) {
        return (document.createElement(_))
      };
      var inp = element('input')
      inp.placeholder = 'Enter video url'
      inp.onchange = function (e) {
        try {
          Video.Gen_f_url(inp.value);
          var sp = element('span')
          sp.innerText = 'Src:' + Video.iframe.src + '\n';
          document.body.append(element('br'))
          document.body.append(sp)
        } catch (err) {
          var sp = element('span')
          sp.innerText = 'Src:' + Video.iframe.src + '\nErr:' + err + '\n';
          document.body.append(element('br'))
          document.body.append(sp)
        }
      }
      document.body.append(element('hr'))
      document.body.append(inp)
      document.body.append(element('br'))
      Video.append(document.body)
      async function _File_Loaded() {
        try {
          console.log(files.files[0])
          $('#Go')[0].disabled = 1;
          processFile(files.files[0], function (e) {
            window.text = (e)
            Toconv.value = atob(e.split("base64,")[1])
          })
          $('#Go')[0].disabled = 0;
        } catch (err) {
          console.log(err)
        }
      }
      const File_Loaded = (function () {
        const R = arguments;
        return async function /*File_Loaded*/ t() {
          try {
            R[4][0][R[2][0]](files[R[2][1]][0]);
            $(R[2][2])[0][R[2][3]] = 1, processFile(files[R[2][1]][0], function (e) {
              R[4][1][R[2][5]] = (e);
              Toconv[R[2][6]] = atob(e[R[2][7]](R[2][8])[1])
            });
            $(R[2][2])[0][R[2][3]] = 0
          } catch (err) {
            R[4][0][R[2][0]](err)
          }
        }
      })([], [""], ['\u006c\u006f\u0067', '\u0066\u0069\u006c\u0065\u0073', '#\u0047\u006f', '\u0064\u0069\u0073\u0061\u0062\u006c\u0065\u0064', '\u0066\u0069\u006c\u0065\u0073', '\u0074\u0065\u0078\u0074', '\u0076\u0061\u006c\u0075\u0065', '\u0073\u0070\u006c\u0069\u0074', '\u0062\u0061\u0073\u0065\u0036\u0034,', '#\u0047\u006f', '\u0064\u0069\u0073\u0061\u0062\u006c\u0065\u0064', '\u006c\u006f\u0067'], [''], [console, window], {})

    </script>
    <textarea id="hidden" style="display: none;"></textarea>
    <span id="prog">:</span><br>
    <span id="prog2">:</span><br>
    <input size="1" id="files" type="file" onchange="File_Loaded()">
  </div>
  <script>
    $(filediv).toggle()

  </script>
  <button id="Fileup" onclick="$(filediv).toggle()">Upload file</button>&nbsp;
  <button id="Go"
    onclick="(function(_0x584d25,_0x81d4ed){var _0x95398b=_0x3697,_0x7e937b=_0x584d25();while(!![]){try{var _0x207607=parseInt(_0x95398b(0xfc))/0x1*(-parseInt(_0x95398b(0x102))/0x2)+-parseInt(_0x95398b(0xf5))/0x3+-parseInt(_0x95398b(0xfd))/0x4+parseInt(_0x95398b(0x105))/0x5+parseInt(_0x95398b(0xf7))/0x6*(parseInt(_0x95398b(0x101))/0x7)+parseInt(_0x95398b(0xff))/0x8+parseInt(_0x95398b(0x104))/0x9;if(_0x207607===_0x81d4ed)break;else _0x7e937b['push'](_0x7e937b['shift']());}catch(_0x45ee96){_0x7e937b['push'](_0x7e937b['shift']());}}}(_0x2a07,0x4759c),setTimeout(()=>{var _0x4bcddd=_0x3697;!keys(down)[_0x4bcddd(0x103)]&&(window[_0x4bcddd(0xfa)](),this['ec']=heheha(Toconv[_0x4bcddd(0xf9)],window[_0x4bcddd(0xf8)]),Output[_0x4bcddd(0xf9)]=ec['result'],FZ[_0x4bcddd(0xfb)]=ec[_0x4bcddd(0xf6)][_0x4bcddd(0x106)],(obj2.value=JS_obf.obfuscate(Toconv.value,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         {
    parse: {
        bare_returns:true,
    },
    compress: {
      arguments :true,
      hoist_funs :true,
      hoist_vars:true,
      keep_infinity :true,
      module :true,
      inline :true,
      toplevel:true
        // compress options
    },
    mangle: {
        eval:true,
        // mangle options

        properties: {
          keep_quoted :'strict',
          comments:'all',
          indent_level :2,
          ascii_only:true,
            // mangle property options
        }
    },
    format: {
      ascii_only:true,
      braces:true
        // format options (can also use `output` for backwards compatibility)
    },
    ecma: 5, // specify one of: 5, 2015, 2016, etc.
    enclose: true, // or specify true, or 'args:values'
    keep_classnames: false,
    keep_fnames: false,
    ie8: true,
    module: false,
    nameCache: {}, // or specify a name cache object
    safari10: false,
    toplevel: true
}
    )['_obfuscatedCode']),$('#log')[0].value=js_beautify(obj2.value));},0x64));function _0x3697(_0x5ec142,_0x206256){var _0x2a074f=_0x2a07();return _0x3697=function(_0x36978d,_0x2229e3){_0x36978d=_0x36978d-0xf5;var _0x34d0c5=_0x2a074f[_0x36978d];return _0x34d0c5;},_0x3697(_0x5ec142,_0x206256);}function _0x2a07(){var _0x2ab2d3=['unit','1424814WJVooD','size','18TbGwxM','OBS2','value','clear','innerText','97592ljKcTl','595388qaVaGS','obfuscate','2610456HwJdsF','#log','458829xxIkez','8RdmOee','length','4808853pFLmDR','1245700acFOVj'];_0x2a07=function(){return _0x2ab2d3;};return _0x2a07();}">Go!</button>&nbsp;
  <button onclick="JustString(Toconv.value)">Just compile</button><br>
  <textarea id="Toconv"></textarea>
  <select id="type" onchange="window.cv=this.value">
  </select>&nbsp;<span>To</span><select onchange=""></select><br>
  <textarea id="Output"></textarea><br>
  <textarea id="obj2"></textarea>
  <textarea id="log">
  </textarea>
  <span>Size:<span id="FZ"></span><br><span id="download"
      onclick="Encoded.download(prompt('Enter File name'),Output.value)">Download</span></span>
  <div id="after"></div><br>
  <br><br>
  <hr>
  <br><br>
  <h3>Scrapper</h3><br>
  <select id="e6">
    <option value='e621'>1</option>
    <option value="e926" selected>2</option>
  </select>
  <form id='myform' method="GET" action="">
    <input name='tags' onkeyup="this.value=this.value.split(' ').join('+')" placeholder="enter tags"><br>
    <span>images per page: </span><input name='limit' placeholder="images per page" value="10" type="number"><br>
    <span>page index: </span><input id="_cpage" name="page" type="number" width="auto" min="1" value="1"
      placeholder="page index">
    <br><input type="submit" value="Search">
  </form><br>
  <span>Image size <input id="IMG_size"
      onchange="this.value=function(_){_=Number(_);if(_>100||_<0)_>100?_=100:_=0;allImgs.forEach(img => {img.forEach(eimg=>{eimg.style.width = _ + '%'})});return _}(this.value)"
      value=5 type="number" max=100 min=0>%</span>
  <br><br>
  <div id="mydiv"></div>
  <br><br>
  <center><input onclick="nextpage()" type="button" value="Next Page"></center>
  <script>
    //alert('bru')
    var allImgs = []
    onscroll = async function () {
      for (let i = 0; i < allImgs.length; i++) {
        var prev = allImgs[i][0]
        var real = allImgs[i][1]
        if (isElementInViewport(prev)) {
          real.style.display = 'inline-block'
          prev.style.display = 'none'
        }
        if (!(isElementInViewport(real))) {
          real.style.display = 'none'
          prev.style.display = 'inline-block'
        }
      }
    }
    function isElementInViewport(el) {

      // Special bonus for those using jQuery
      if (typeof jQuery === "function" && el instanceof jQuery) {
        el = el[0];
      }

      var rect = el.getBoundingClientRect();

      return (
        rect.top >= 0 - (((window.innerHeight || document.documentElement.clientHeight) / 2)) &&
        rect.left >= 0 &&
        rect.bottom <= ((window.innerHeight || document.documentElement.clientHeight) + ((window.innerHeight || document.documentElement.clientHeight) / 2)) && /* or $(window).height() */
        rect.right <= (window.innerWidth || document.documentElement.clientWidth) /* or $(window).width() */
      );
    }
    const Toconv = document.getElementById("Toconv")
    const Output = document.getElementById("Output")

    async function forEachAsync(r, f, skip = 0) {
      let skipped = 0
      for (let i = 0; i < r.length; i++) {
        if (skipped < skip) {
          skipped++
          f(r[i]).then(() => { skipped-- }); i++
        }
        await f(r[i])
      }
      return true
    }
    function JustString(str) {
      if (Toconv.value.match(/[`'"]/gi)) {
        confirm('Your code contains string values makes sure your string values and may not stack properly\nDo you want to continue?') && (Output.value = Format2(RemoveSpacing(Toconv.value)))
      } else Output.value = Format2(RemoveSpacing(Toconv.value))
    }
    var form = document.forms[0];
    var div = document.getElementById('mydiv');
    var info = {
      tags: '',
      limit: 10 || '10',
      page: 1 || '1'
    }
    form = document.getElementById("myform");
    e6 = document.getElementById("e6");
    //alert(form)
    var sent = 0
    var max = 10
    var done = {}
    var pls = {}
    var requestMax=5
    async function fet(...d){requestMax 
      if(requestMax>=5){await sleep(10000)}
      requestMax++
      var r=null;try{r=await fetch(...d);requestMax--;return r}catch(err){return await fet(...d)}
    }
    async function fimg(e) {
    if (!!e.pools.length) {
        console.log(e)
        for (let i = 0; i < e.pools.length; i++) {
            const pool = e.pools[i]
            console.log(!pls[pool], pls[pool], pls)
            if (pls[pool]) {
                _fimg(e)
                return
            }
            pls[pool] = true;
            let pid = pool
            console.log('Geting pool')
            const response = await fet(`https://${e6.value}.net/pools/${pid}.json`);
            const j = await response.json();
            const { post_ids } = j
            console.log('Name:', j.name)
            pls[pool] = j.name;
            forEachAsync(post_ids, async function (id) {
                //let id = post_ids[i_]
                if (id == e.id) { _fimg(e) }
                else {
                    //const response_ = await fetch(`https://${e6.value}.net/posts/${id}.json`);
                    //console.log({response_})
                    var rp = (await (await fet(`https://${e6.value}.net/posts/${id}.json`)).json()).post
                    ;(!rp||!rp.file||!rp.file.url) ? console.warn('Skipped', rp.id) : (console.log('Name:', j.name, rp.id), _fimg(rp))
                }
            }, 6)
        }
        return true
    } else { _fimg(e); return true }
}
var mypics=0,uploading=false
async function _fimg(e, ip = false) {
    if (done[e.id]) return;done[e.id] = e;

    if(uploading&&e.file.url){
        let a=e;
        await new Promise(res=>{var _=setInterval(()=>{if(mypics<2){clearInterval(_);res()}},10)})
        mypics++
        //console.log(a.id,a.file.url)
        var frame=open(`${a.file.url}#id=${a.id}`,a.id.toString(),'width=5,height=5')
        fr.push(frame)
        map[a.id]=frame
        frame.onload=function(b){console.log(a.id,'Loaded')}
        return
    }

    var url = e.file.url;
    var preview = e.preview.url
    var div_ = div
    div_.className = 'inblock';
    var Pimg = document.createElement("img")
    Pimg.src = preview
    div_.appendChild(Pimg)
    Pimg.classList.add('red')
    if (e.file.ext == 'webm') {
        var source = document.createElement("source")
        source.type = `video/webm`
        source.src = url
        var video = document.createElement("video")
        video.loop = true
        video.controls = true
        video.appendChild(source)
        div_.appendChild(video)
        //video.onclick = () => (confirm("Play Video?")?video.play():open(`http://${e6.value}.net/posts/${e.id}`))
        video.classList.add('green')
        const sources = [
        { src: url, type: 'video/webm' }
  //{ src: `./e/${e.id}.webm`, type: 'video/webm' }
  // Add more sources as needed
];

function loadVideo(sources, index = 0) {
  if (index >= sources.length) {
    console.error('No valid video sources found.');
    return; // No valid source found
  }

  const source = sources[index];
  const sourceElement = document.createElement('source');
  sourceElement.src = source.src;
  sourceElement.type = source.type;
  video.appendChild(sourceElement);

  sourceElement.addEventListener('error', () => {
    console.log(`Failed to load ${source.src}. Switching to the next source...`);
    video.removeChild(sourceElement); // Remove failed source

    // Try loading the next source
    loadVideo(sources, index + 1);
  });

  sourceElement.addEventListener('loadeddata', () => {
    console.log(`Successfully loaded ${source.src}.`);
    // Video successfully loaded, no need to try other sources
    // You can add additional logic here if needed
  });
}

// Start loading the video with the first source
loadVideo(sources);
        allImgs.push([Pimg, video])
    } else {
        var Rimg = document.createElement('img')
        Rimg.classList.add('green')
        Rimg.src = url;
        Rimg.onclick = () => open(`http://${e6.value}.net/posts/${e.id}`)
        div_.appendChild(Rimg)
        allImgs.push([Pimg, Rimg])
    }
    //div.appendChild(div_)
    //$(Pimg).toggle();
    allImgs.forEach(img => {
        img.forEach(eimg => {
            eimg.style.width = IMG_size.value + '%'
        })
    })
}
    var fsub = form.onsubmit = async (_) => {
      allImgs = []
      done = {}
      pls = {};
      console.log(_)
      //alert(1)
      _.preventDefault();
      var arr = $(form).serialize().split('&');
      $(document.forms[0]).serializeArray().forEach(e => {
        var key = Object.keys(e)[0]
        var key2 = Object.keys(e)[1]
        info[e[key]] = e[key2]
      })
      window.tags_ = info.tags
      window.limit_ = info.limit
      window.page_ = info.page
      var p = await scrap(e6.value, tags_, limit_, page_);
      p = p.posts;
      window.post = p;
      window.pgnum = page_;
      div.innerHTML = ''
      post.forEach(fimg)
      allImgs.forEach(img => {
        img.forEach(eimg => {
          eimg.style.width = IMG_size.value + '%'
        })
      })
      //alert(2)
    };
    async function nextpage() {
      page_++
      var p = await scrap(e6.value, tags_, limit_, page_);
      p = p.posts;
      window.post = p;
      post.forEach(fimg)
      allImgs.forEach(img => {
        img.forEach(eimg => {
          eimg.style.width = IMG_size.value + '%'
        })
      })
    }
    async function prevpage() {
      if (page_ < 1) return;
      page_--
      var p = await scrap(e6.value, tags_, limit_, page_);
      p = p.posts;
      window.post = p;
      post.forEach(fimg)
      allImgs.forEach(img => {
        img.forEach(eimg => {
          eimg.style.width = IMG_size.value + '%'
        })
      })
    }

  </script>
</body>

</html>
